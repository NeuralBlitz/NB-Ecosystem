# Backup & Recovery Procedures

## Backup Strategy

### Encrypted Backup Script

Location: `/home/runner/workspace/scripts/backup.sh`

```bash
#!/bin/bash
# NeuralBlitz Encrypted Backup Script
# Usage: ./backup.sh [encrypt]

set -e

BACKUP_DIR="/home/runner/workspace/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_NAME="neuralblitz_backup_${DATE}"

# Create backup directory
mkdir -p "$BACKUP_DIR"

# Directories to backup (CRITICAL ASSETS ONLY)
CRITICAL_DIRS=(
    "NBX-LRS"
    "NB-Ecosystem"
    "Emergent-Prompt-Architecture"
    "opencode-lrs-agents-nbx"
    "Advanced-Research"
    "quantum_sim"
    "lrs-agents"
    "ComputationalAxioms"
)

echo "ðŸ§  Creating NeuralBlitz backup..."
echo "ðŸ“… Date: $DATE"

# Create temporary backup
TEMP_BACKUP="/tmp/${BACKUP_NAME}.tar.gz"
tar -czf "$TEMP_BACKUP" \
    --exclude='.git' \
    --exclude='node_modules' \
    --exclude='__pycache__' \
    --exclude='*.pyc' \
    --exclude='.env' \
    "${CRITICAL_DIRS[@]}"

# Get size
SIZE=$(du -h "$TEMP_BACKUP" | cut -f1)
echo "ðŸ“¦ Backup created: ${BACKUP_NAME}.tar.gz ($SIZE)"

# Encrypt if requested
if [ "$1" == "encrypt" ]; then
    echo "ðŸ”’ Encrypting backup..."
    ENCRYPTED_BACKUP="${BACKUP_DIR}/${BACKUP_NAME}.tar.gz.gpg"
    gpg --symmetric --cipher-algo AES256 "$TEMP_BACKUP" -o "$ENCRYPTED_BACKUP"
    rm "$TEMP_BACKUP"
    echo "âœ… Encrypted backup: ${BACKUP_NAME}.tar.gz.gpg"
    echo "âš ï¸  Store the password securely!"
else
    mv "$TEMP_BACKUP" "${BACKUP_DIR}/${BACKUP_NAME}.tar.gz"
    echo "âœ… Backup saved: ${BACKUP_DIR}/${BACKUP_NAME}.tar.gz"
fi

# Create manifest
MANIFEST="${BACKUP_DIR}/${BACKUP_NAME}_manifest.txt"
echo "NeuralBlitz Backup Manifest" > "$MANIFEST"
echo "===========================" >> "$MANIFEST"
echo "Date: $DATE" >> "$MANIFEST"
echo "Directories:" >> "$MANIFEST"
for dir in "${CRITICAL_DIRS[@]}"; do
    SIZE=$(du -sh "$dir" 2>/dev/null | cut -f1 || echo "N/A")
    echo "  - $dir ($SIZE)" >> "$MANIFEST"
done
echo "" >> "$MANIFEST"
echo "Generated by backup script" >> "$MANIFEST"

echo "ðŸ“ Manifest created: ${BACKUP_NAME}_manifest.txt"

# Cleanup old backups (keep last 7)
echo "ðŸ§¹ Cleaning up old backups..."
find "$BACKUP_DIR" -name "neuralblitz_backup_*.tar.gz" -mtime +7 -delete
find "$BACKUP_DIR" -name "neuralblitz_backup_*.tar.gz.gpg" -mtime +7 -delete
find "$BACKUP_DIR" -name "neuralblitz_backup_*.txt" -mtime +7 -delete

echo "âœ… Backup complete!"
```

## Recovery Procedures

### Restore from Backup

```bash
# 1. List available backups
ls -la /home/runner/workspace/backups/

# 2. Decrypt if encrypted
gpg -d backups/neuralblitz_backup_20260208_120000.tar.gz.gpg > /tmp/restored.tar.gz

# 3. Extract to temporary location
tar -xzf /tmp/restored.tar.gz -C /tmp/

# 4. Verify contents
ls -la /tmp/NBX-LRS/

# 5. Restore specific directory
cp -r /tmp/NBX-LRS/* /home/runner/workspace/NBX-LRS/

# 6. Clean up
rm -rf /tmp/restored.tar.gz /tmp/NBX-LRS
```

### Emergency Recovery

If workspace is compromised:

```bash
# 1. Immediately disconnect from network
# 2. Identify compromised directories
# 3. Restore from last known good backup
# 4. Rotate all API keys
# 5. Review access logs
```

## Backup Schedule

| Backup Type | Frequency | Retention | Location |
|-------------|-----------|-----------|----------|
| Full Encrypted | Weekly | 12 months | Off-site (secure) |
| Full Unencrypted | Daily | 7 days | Local + external drive |
| Incremental | Hourly | 24 hours | Local only |

## Verification Checklist

After any backup:
- [ ] Backup file exists
- [ ] Backup size is reasonable (>1MB for full backup)
- [ ] Manifest is complete
- [ ] Test extraction (dry-run)
- [ ] Verify encryption (if applicable)

## Secure Storage Locations

1. **Primary**: `/home/runner/workspace/backups/` (local)
2. **Secondary**: Encrypted external drive
3. **Tertiary**: Secure cloud storage (encrypted)

---
*Document created: 2026-02-08*
